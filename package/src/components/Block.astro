---
import { getEntries } from 'astro:content'

interface Props {
  _bookshop_name?: string
  [key: string | number | symbol]: any
}

const packageBlocks = await Astro.glob('./blocks/**/*.astro')
// const userBlocks = (await Astro.glob('/src/components/blocks/**/*.astro')) ?? []
// const userBlocks = import.meta.glob('/src/components/blocks/**/*.astro') ?? []
const userBlocks: any = []

const components = [...userBlocks, ...packageBlocks]

const { _bookshop_name, ...rest } = Astro.props

const Component = components.find((component) => {
  const fileName = component.default.moduleId?.split('/').pop()
  const componentName = fileName?.split('.')[0]
  return componentName === _bookshop_name
})?.default

rest.pages = rest.pages && (await getEntries(rest.pages))
rest.cards = rest.cards && (await getEntries(rest.cards))
rest.posts = rest.posts && (await getEntries(rest.posts))
rest.products = rest.products && (await getEntries(rest.products))
rest.categories = rest.categories && (await getEntries(rest.categories))
---

{Component && <Component {...rest} />}
