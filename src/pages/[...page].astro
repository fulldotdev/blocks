---
import { getCollection } from 'astro:content'
import comps from '../comps'
import { mergeEntries } from '../utils/mergeEntries'

export async function getStaticPaths() {
  const pages = await getCollection('pages')
  return pages.map((page) => ({
    params: {
      page: page.slug === 'index' ? undefined : page.slug,
    },
    props: page,
  }))
}

const { data, slug, ...rest } = Astro.props

const merged = (await mergeEntries({ data, slug })) as any
const Layout = (comps as any)[merged.data._layout ?? 'PageLayout']
---

<Layout
  data={merged.data}
  {...rest}
/>
