---
import { getCollection } from 'astro:content'
import PageLayout from '../layouts/PageLayout.astro'
import PolicyLayout from '../layouts/PolicyLayout.astro'
import PostLayout from '../layouts/PostLayout.astro'

export async function getStaticPaths() {
  const pages = await getCollection('pages')
  return pages.map((page) => ({
    params: {
      page: page.slug === 'index' ? undefined : page.slug,
    },
    props: page,
  }))
}

const { data, render } = Astro.props
const { Content, headings } = await render()

const layouts = {
  page: PageLayout,
  post: PostLayout,
  policy: PolicyLayout,
}

const Layout = layouts[data._schema] ?? PageLayout
---

<Layout
  class:list={'page'}
  {...Astro.props}
>
  <slot />
</Layout>
